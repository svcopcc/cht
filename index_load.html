<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ç«™å°æª¢æŸ¥è¨˜éŒ„ï¼ˆæœ€çµ‚ç‰ˆï¼‰</title>
  <style>
    body { font-family: sans-serif; background: #f6f6f6; padding: 1em; }
    table { width: 100%; border-collapse: collapse; margin-top: 1em; table-layout: auto; }
    thead th { position: sticky; top: 0; background-color: #e0e0e0; z-index: 2; }
    th, td { padding: 0.5em; border: 1px solid #ccc; font-size: 0.9em; background: #fff; }
    td.tsCol { width: 1px !important; max-width: 1px !important; overflow: hidden; padding: 0; color: transparent; }
    .score-red { background-color: #f8d7da; color: #a94442; }
    .score-yellow { background-color: #fff3cd; color: #856404; }
    .score-green { background-color: #d4edda; color: #155724; }
  </style>
</head>
<body>
<h2>ğŸ“‹ ç«™å°å¹´åº¦æª¢æŸ¥è¨˜éŒ„ï¼ˆæœ€çµ‚VBAè½‰æ›ç‰ˆï¼‰</h2>
<table id="dataTable">
  <thead>
    <tr>
      <th class="tsCol">æ™‚é–“æˆ³è¨˜</th>
      <th>åŸºåœ°å°åç¨±</th>
      <th>è½„å€</th>
      <th>å‹å¼</th>
      <th>é«˜åº¦(ç±³)</th>
      <th>ä¸ŠæœŸç¶­è­·</th>
      <th>æœ¬æ¬¡æª¢æŸ¥</th>
      <th>æª¢æŸ¥èˆ‡æ”¹å–„</th>
      <th>å®Œæˆæ—¥æœŸ</th>
      <th>å‚™   è¨»</th>
      <th>è¥¿å…ƒæª¢æŸ¥æ—¥æœŸ</th>
      <th>è©•åˆ†</th>
      <th>ç§å¯†å‚™è¨»</th>
      <th>3Gæ‹†å°ç´€éŒ„/æ–½å·¥äººå“¡</th>
      <th>ä¸»é«”è¨­å‚™(ç³»çµ±/å°„é »/é›»åŠ›)</th>
      <th>Pipe(æ”¯)</th>
      <th>å®¤å¤–å‹å¤©ç·š(æ”¯)</th>
      <th>SMR(çµ„)</th>
      <th>Mini shelter/å°å‹æ©Ÿæ«ƒ(åª)</th>
      <th>é›»éŒ¶ç®±/é…é›»ç®±(åª)</th>
      <th>éŒ¢éŒ¢</th>
    </tr>
  </thead>
  <tbody id="tableBody">
    <!-- JS è¼‰å…¥ -->
  </tbody>
</table>

<script>
const sheetURL = 'https://docs.google.com/spreadsheets/d/1ugs7DSY094iZuxkEaZZNQozSXGzSWFx_AUvh1IeTPq0/gviz/tq?tqx=out:json';
const tableBody = document.getElementById('tableBody');

function toTW(isoDate) {
  const d = new Date(isoDate);
  if (isNaN(d)) return '';
  return `æ°‘åœ‹${d.getFullYear() - 1911}å¹´${d.getMonth() + 1}æœˆ${d.getDate()}æ—¥`;
}

function getScoreClass(score) {
  if (score === 'S') return 'score-green';
  if (score === 'A') return 'score-yellow';
  if (score === 'B') return 'score-red';
  return '';
}

function buildResl(row) {
  const å‹å¼ = row['å‹å¼'];
  let resl = '';
  if (å‹å¼ && å‹å¼.includes('å››è§’')) {
    const é˜²å¢œ = row['1-2_éµå¡”_é˜²å¢œå™¨'] || '';
    const æ‹‰ç·šæ•¸ = row['æ‹‰ç·šæ•¸é‡'] || '';
    const çµç·š = row['æ‹‰ç·šç¨®é¡'] || '';
    const æ‹‰ç·šç‹€æ…‹ = row['2-1_æ‹‰ç·š'] || '';
    const å‚™è¨» = row['2-1-1_æ‹‰ç·š_å‚™è¨»'] || '';
    const ä¿é¤Š = row['4_ä¿é¤Šé¸é …'] || '';
    const é…ä»¶å‚™è¨» = row['3-3.é…ä»¶_å‚™è¨»'] || '';
    const å…¶ä»–å‚™è¨» = row['4_å…¶ä»–_å‚™è¨»'] || '';
    const é…ä»¶é¡å‹ = row['é…ä»¶å·¡æª¢'] || '';

    resl += (row['1-1_éµå¡”_è§’åº¦'] === 'åˆæ ¼') ? 'éµå¡”è§’åº¦åˆæ ¼ï¼Œ' : 'éµå¡”è§’åº¦èª¿æ•´*******ï¼Œ';

    if (é˜²å¢œ === 'åˆæ ¼') resl += 'é˜²å¢œå™¨æª¢æŸ¥åˆæ ¼ï¼Œ';
    else if (é˜²å¢œ === 'ç„¡é˜²å¢œå™¨') resl += 'ç„¡é˜²å¢œå™¨ï¼Œ';
    else if (é˜²å¢œ === 'ä¸éœ€é˜²å¢œå™¨') resl += '';
    else resl += 'é˜²å¢œå™¨èª¿æ•´ï¼Œ';

    if (æ‹‰ç·šç‹€æ…‹ === 'åˆæ ¼') {
      resl += `æ‹‰ç·š(${æ‹‰ç·šæ•¸}æ¢${çµç·š})æª¢æŸ¥åˆæ ¼ï¼Œ`;
    } else {
      resl += `æ‹‰ç·š(${æ‹‰ç·šæ•¸}æ¢${çµç·š})${æ‹‰ç·šç‹€æ…‹}${å‚™è¨»}ï¼Œ`;
    }

    if (é…ä»¶é¡å‹ === 'é…ä»¶-å…¨éƒ¨åˆæ ¼-æŸæ²¹æ¼†ä¿é¤Š') {
      if (!ä¿é¤Š.includes('æœªå¡—æŸæ²¹æ¼†')) resl += 'é…ä»¶å¡—åˆ·æŸæ²¹æ¼†ä¿é¤Šï¼Œ';
    } else if (é…ä»¶é¡å‹ === 'é…ä»¶-å…¨éƒ¨åˆæ ¼-é‹¼ç´¢å¤¾') {
      if (!ä¿é¤Š.includes('æœªå¡—æŸæ²¹æ¼†')) resl += 'é…ä»¶å¡—åˆ·æŸæ²¹æ¼†ä¿é¤Šï¼Œé‹¼ç´¢å¤¾æª¢æŸ¥èª¿ç·Šï¼Œ';
    } else {
      if (!ä¿é¤Š.includes('æœªå¡—æŸæ²¹æ¼†')) resl += 'é…ä»¶å¡—åˆ·æŸæ²¹æ¼†ä¿é¤Šï¼Œ';
      resl += é…ä»¶å‚™è¨» + 'ï¼Œ';
    }

    resl += å…¶ä»–å‚™è¨» || '';
    if (row['5_é™¤è‰'] === 'æ˜¯') resl += 'ä»¥åŠé™¤è‰';
  } else {
    resl = (row['NON-å‹å¼'] || '') + 'æª¢æŸ¥åˆæ ¼ï¼Œ';
    const arr = (row['NON-æª¢æŸ¥èˆ‡æ”¹å–„'] || '').split(', ').filter(s => s !== 'NOO');
    resl += arr.join('ï¼Œ');
    if (row['5_é™¤è‰'] === 'æ˜¯') resl += 'ä»¥åŠé™¤è‰';
  }

  return resl.replace(/ï¼Œ$/, 'ã€‚').replace(/ã€‚$/, 'ã€‚').replace(/ï¼Œï¼Œ/g, 'ï¼Œ');
}

async function loadData() {
  const res = await fetch(sheetURL);
  const text = await res.text();
  const json = JSON.parse(text.substring(47).slice(0, -2));
  const headers = json.table.cols.map(col => col.label);
  const rows = json.table.rows;

  rows.forEach(r => {
    const row = {};
    headers.forEach((h, i) => row[h] = r.c[i] ? r.c[i].v : '');
    const tr = document.createElement('tr');

    const tds = [
      ['æ™‚é–“æˆ³è¨˜', 'tsCol'],
      ['åŸºåœ°å°åç¨±'], ['è½„å€'], ['å‹å¼'], ['é«˜åº¦(ç±³)'],
      ['ä¸ŠæœŸç¶­è­·'],
      [toTW(row['å·¡æª¢æ—¥æœŸ'] || row['æ™‚é–“æˆ³è¨˜'])], // æœ¬æ¬¡æª¢æŸ¥
      [buildResl(row)], // æª¢æŸ¥èˆ‡æ”¹å–„
      ['å®Œæˆæ—¥æœŸ'], ['å‚™   è¨»'],
      [row['å·¡æª¢æ—¥æœŸ'] || row['æ™‚é–“æˆ³è¨˜']],
      [row['7_è©•åˆ†'], getScoreClass(row['7_è©•åˆ†'])],
      ['ç§å¯†å‚™è¨»'], ['8.2_3Gæ‹†å°_æ–½å·¥äººå“¡'], ['8.1_3Gæ‹†å°_æ•¸é‡ [ä¸»é«”è¨­å‚™(ç³»çµ±/å°„é »/é›»åŠ›)]'],
      ['8.1_3Gæ‹†å°_æ•¸é‡ [Pipe(æ”¯)]'], ['8.1_3Gæ‹†å°_æ•¸é‡ [å®¤å¤–å‹å¤©ç·š(æ”¯)]'], ['8.1_3Gæ‹†å°_æ•¸é‡ [SMR(çµ„)]'],
      ['8.1_3Gæ‹†å°_æ•¸é‡ [Mini shelter/å°å‹æ©Ÿæ«ƒ(åª)]'], ['8.1_3Gæ‹†å°_æ•¸é‡ [é›»éŒ¶ç®±/é…é›»ç®±(åª)]'], ['éŒ¢éŒ¢']
    ];

    tds.forEach(([key, cls]) => {
      const td = document.createElement('td');
      td.textContent = row[key] || key;
      if (cls) td.className = cls;
      tr.appendChild(td);
    });

    tableBody.appendChild(tr);
  });
}

loadData();
</script>
</body>
</html>
