
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>ç«™å°æª¢æŸ¥è¡¨ï¼ˆä¿®æ­£å®Œæˆç‰ˆï¼‰</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f9f9f9; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 4px; text-align: center; }
    th.sticky { position: sticky; top: 0; background: #eee; z-index: 2; }
    td.score-S { background: #d4edda; }
    td.score-A { background: #fff3cd; }
    td.score-B { background: #f8d7da; }
    td.tsCol { width: 1px !important; max-width: 1px !important; overflow: hidden; font-size: 0.5em; color: transparent; }
  </style>
</head>
<body>
<h2>ğŸ“‹ ç«™å°å¹´åº¦æª¢æŸ¥ç´€éŒ„</h2>

<label>é¸æ“‡å¹´åº¦ï¼š
  <select id="yearSelect">
    <option value="114">114</option>
    <option value="113">113</option>
    <option value="112">112</option>
    <option value="custom">è‡ªè¨‚</option>
  </select>
  <input type="text" id="customYear" placeholder="è¼¸å…¥å¹´åº¦" style="display:none;">
</label>

<p id="debug"></p>
<table id="dataTable">
  <thead><tr id="headerRow"></tr></thead>
  <tbody id="dataBody"></tbody>
</table>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTnvECTbipdQIBkYB1-s4MgjWbTVQc5KkvoQuamlv8u7Q7rUCoV4TMpWfg4v2zowFRQNwhHWDnO9_n1/pub?output=csv';
const headers = [
  'æ™‚é–“æˆ³è¨˜','åŸºåœ°å°åç¨±','è½„å€','å‹å¼','é«˜åº¦(ç±³)','ä¸ŠæœŸç¶­è­·','æœ¬æ¬¡æª¢æŸ¥','æª¢æŸ¥èˆ‡æ”¹å–„',
  'å®Œæˆæ—¥æœŸ','å‚™   è¨»','è¥¿å…ƒæª¢æŸ¥æ—¥æœŸ','è©•åˆ†','ç§å¯†å‚™è¨»',
  '3Gæ‹†å°ç´€éŒ„/æ–½å·¥äººå“¡','ä¸»é«”è¨­å‚™(ç³»çµ±/å°„é »/é›»åŠ›)','Pipe(æ”¯)','å®¤å¤–å‹å¤©ç·š(æ”¯)',
  'SMR(çµ„)','Mini shelter/å°å‹æ©Ÿæ«ƒ(åª)','é›»éŒ¶ç®±/é…é›»ç®±(åª)','éŒ¢éŒ¢'
];

const headerRow = document.getElementById('headerRow');
const tableBody = document.getElementById('dataBody');

headers.forEach(h => {
  const th = document.createElement('th');
  th.textContent = h;
  th.classList.add("sticky");
  if (h === 'æ™‚é–“æˆ³è¨˜') th.classList.add("tsCol");
  headerRow.appendChild(th);
});

document.getElementById('yearSelect').addEventListener('change', () => {
  document.getElementById('customYear').style.display =
    document.getElementById('yearSelect').value === 'custom' ? 'inline' : 'none';
  loadSheet();
});
document.getElementById('customYear').addEventListener('input', loadSheet);

function getSelectedYear() {
  const y = document.getElementById('yearSelect').value;
  return y === 'custom' ? document.getElementById('customYear').value : y;
}

function toTWShortDate(isoStr) {
  const d = new Date(isoStr);
  if (isNaN(d)) return '';
  return `${d.getFullYear() - 1911}/${d.getMonth() + 1}/${d.getDate()}`;
}

function extractDate(isoStr) {
  const d = new Date(isoStr);
  if (isNaN(d)) return '';
  return `${d.getFullYear()}/${d.getMonth() + 1}/${d.getDate()}`;
}

function loadSheet() {
  Papa.parse(csvUrl, {
    download: true,
    header: true,
    complete: function(result) {
      const year = getSelectedYear();
      const rows = result.data.filter(g => g['å¹´åº¦è¨­å®š'] === year);
      document.getElementById('debug').textContent = `è¼‰å…¥ ${rows.length} ç­†`;
      tableBody.innerHTML = '';

      rows.forEach(g => {
        const row = document.createElement('tr');
        const dateSource = g['å·¡æª¢æ—¥æœŸ'] || g['æ™‚é–“æˆ³è¨˜'];
        const æœ¬æ¬¡æª¢æŸ¥ = toTWShortDate(dateSource);
        const è¥¿å…ƒæª¢æŸ¥æ—¥æœŸ = extractDate(dateSource);

        const data = [
          g['æ™‚é–“æˆ³è¨˜'], g['ç«™å°åç¨±'], g['è½„å€(é«˜é›„ã€é³³å±±....)'],
          `${g['éµå¡”ç¯€æ•¸']}ç¯€ (${g['éµå¡”å‹æ…‹']})`,
          g['éµå¡”ç¯€æ•¸'] === '1.5' ? 8.7 : isNaN(g['éµå¡”ç¯€æ•¸']) ? '*' : (+g['éµå¡”ç¯€æ•¸'] * 5.5).toFixed(1),
          '', æœ¬æ¬¡æª¢æŸ¥, '', '', '', è¥¿å…ƒæª¢æŸ¥æ—¥æœŸ,
          g['7_è©•åˆ†'], g['ç§å¯†å‚™è¨»'], '', '', '', '', '', '', '', ''
        ];

        data.forEach((text, i) => {
          const td = document.createElement('td');
          td.textContent = text || '';
          if (i === 0) td.classList.add('tsCol');
          if (headers[i] === 'è©•åˆ†') td.classList.add('score-' + text);
          row.appendChild(td);
        });

        tableBody.appendChild(row);
      });
    }
  });
}

loadSheet();
</script>
</body>
</html>
