<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>ç«™å°æª¢æŸ¥è¡¨</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f9f9f9; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 4px; text-align: center; }
    th.sticky { position: sticky; top: 0; background: #eee; z-index: 2; }
    td.tsCol { width: 1px; max-width: 1px; font-size: 0.1em; color: transparent; }
    td.green { background-color: #d4edda; }
    td.yellow { background-color: #fff3cd; }
    td.red { background-color: #f8d7da; }
    .fade-out {
    opacity: 1;
    transition: opacity 1s ease-out;
    }
    .fade-out.hidden {
      opacity: 0;
    }
  </style>
</head>
<body>
<h2>
  <a href="https://svcopcc.github.io/cht/" style="text-decoration: none; display: inline-flex; align-items: center;">
    <img src="https://i.imgur.com/bgRG0SJ.png" alt="icon" style="height: 1em; vertical-align: middle; margin-right: 0.3em;">
  </a>
  ç«™å°å¹´åº¦æª¢æŸ¥ç´€éŒ„
</h2>


<!-- è¼‰å…¥é»ƒè‰²å€ -->
<div id="debug" style="background: #fffbe6; color: #333; padding: 1em; margin-top: 1em; border: 1px dashed #aaa; font-size: 0.9em; white-space: pre-wrap;"></div>
  
<label>é¸æ“‡å·¡æª¢å¹´åº¦ï¼š
  <select id="yearSelect">
    <option value="114">114</option>
    <option value="113">113</option>
    <option value="112">112</option>
    <option value="custom">è‡ªè¨‚</option>
  </select>
  <input type="text" id="customYear" placeholder="è¼¸å…¥å¹´åº¦" style="display:none;">
  <button id="customYearBtn" style="display:none;">åŸ·è¡Œ</button> <!-- âœ… æ–°å¢æŒ‰éˆ• -->
</label>


<!-- ç¯©é¸æ§åˆ¶å€ -->
<div style="margin-bottom: 1em;">
  <button onclick="toggleCols(['æ™‚é–“æˆ³è¨˜', 'è¥¿å…ƒæª¢æŸ¥æ—¥æœŸ'])">é¡¯ç¤ºæ™‚é–“æˆ³è¨˜</button>
  <button onclick="toggleCols(['3Gæ‹†å°ç´€éŒ„/æ–½å·¥äººå“¡','ä¸»é«”è¨­å‚™(ç³»çµ±/å°„é »/é›»åŠ›)','Pipe(æ”¯)','å®¤å¤–å‹å¤©ç·š(æ”¯)','SMR(çµ„)','Mini shelter/å°å‹æ©Ÿæ«ƒ(åª)','é›»éŒ¶ç®±/é…é›»ç®±(åª)','éŒ¢éŒ¢'])">é¡¯ç¤º3Gæ‹†å°è³‡æ–™</button>
  <button onclick="toggleCols(['è©•åˆ†'])">é¡¯ç¤ºè©•åˆ†</button>
  <label style="margin-left: 1em;">å¯†ç¢¼ï¼š
    <input type="password" id="secretPwd" />
    <button onclick="checkPassword()">è§£å¯†</button>
  </label>
</div>
  
  
<table id="dataTable">
  <thead><tr id="headerRow"></tr></thead>
  <tbody id="dataBody"></tbody>
</table>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
let allRows = [];
//èˆŠ
//const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTnvECTbipdQIBkYB1-s4MgjWbTVQc5KkvoQuamlv8u7Q7rUCoV4TMpWfg4v2zowFRQNwhHWDnO9_n1/pub?output=csv';
//æ–°
const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTxf_VkN9MaMDWj5sQTlvcx-9WtEypM-b7gUCltbO922I3KrHJtxN0-WNqCtiB8LyIKJnOBQZEOU00u/pub?output=csv';
//âœ… éš±è—åŸå§‹ Google Sheet é€£çµ
//const csvUrl = 'https://script.google.com/macros/s/AKfycbxtNmgzoQxqZHqrz9am2x_lzF-atVEfUx06Eqq5Td_3iR8hyjYRjeP-5ocM9P9G9sgq/exec'; 
const headers = ['æ™‚é–“æˆ³è¨˜','åŸºåœ°å°åç¨±','è½„å€','å‹å¼','é«˜åº¦(ç±³)','ä¸ŠæœŸç¶­è­·','æœ¬æ¬¡æª¢æŸ¥','æª¢æŸ¥èˆ‡æ”¹å–„',
  'å®Œæˆæ—¥æœŸ','å‚™   è¨»','è¥¿å…ƒæª¢æŸ¥æ—¥æœŸ','è©•åˆ†','ç§å¯†å‚™è¨»','3Gæ‹†å°ç´€éŒ„/æ–½å·¥äººå“¡',
  'ä¸»é«”è¨­å‚™(ç³»çµ±/å°„é »/é›»åŠ›)','Pipe(æ”¯)','å®¤å¤–å‹å¤©ç·š(æ”¯)','SMR(çµ„)','Mini shelter/å°å‹æ©Ÿæ«ƒ(åª)','é›»éŒ¶ç®±/é…é›»ç®±(åª)','éŒ¢éŒ¢','å¹´åº¦è¨­å®š'];

<!-- é è¨­éš±è— -->
// é è¨­è¦éš±è—çš„æ¬„ä½åç¨±
const hiddenCols = ['æ™‚é–“æˆ³è¨˜','å®Œæˆæ—¥æœŸ','è¥¿å…ƒæª¢æŸ¥æ—¥æœŸ','ç§å¯†å‚™è¨»','3Gæ‹†å°ç´€éŒ„/æ–½å·¥äººå“¡',
  'ä¸»é«”è¨­å‚™(ç³»çµ±/å°„é »/é›»åŠ›)','Pipe(æ”¯)','å®¤å¤–å‹å¤©ç·š(æ”¯)','SMR(çµ„)','Mini shelter/å°å‹æ©Ÿæ«ƒ(åª)',
  'é›»éŒ¶ç®±/é…é›»ç®±(åª)','éŒ¢éŒ¢','è©•åˆ†'];
<!-- #END_é è¨­éš±è— -->

function toTWDate(iso) {
  const d = new Date(iso);
  return isNaN(d) ? '' : `${d.getFullYear() - 1911}/${d.getMonth() + 1}/${d.getDate()}`;
}
function toDateOnly(dateStr) {
  if (!dateStr || typeof dateStr !== 'string') return '';

  // ç§»é™¤å…¨å½¢ç©ºæ ¼ã€æ¨™æº–åŒ–æ ¼å¼
  dateStr = dateStr.replace(/\u3000/g, ' ').replace(/\s+/g, ' ').trim();

  // å…ˆè©¦è©¦çœ‹ new Date èƒ½ä¸èƒ½åƒï¼ˆæœ‰äº›æƒ…æ³ä¸‹æœƒæ”¯æ´ï¼‰
  let d = new Date(dateStr);
  if (!isNaN(d)) {
    return `${d.getFullYear()}/${d.getMonth() + 1}/${d.getDate()}`;
  }

  // å˜—è©¦æ‰‹å‹•è§£æã€Œ2025/1/22 ä¸‹åˆ5:33:58ã€
  const match = dateStr.match(/^(\d{4})[\/\-](\d{1,2})[\/\-](\d{1,2})\s*(ä¸Šåˆ|ä¸‹åˆ)?\s*(\d{1,2}):(\d{2}):(\d{2})$/);
  if (match) {
    let [_, y, m, d2, ampm, h, min, sec] = match;
    h = parseInt(h, 10);
    if (ampm === 'ä¸‹åˆ' && h < 12) h += 12;
    if (ampm === 'ä¸Šåˆ' && h === 12) h = 0;
    const iso = `${y}-${m.padStart?.(2, '0') || m}-${d2.padStart?.(2, '0') || d2}T${String(h).padStart(2, '0')}:${min}:${sec}`;
    d = new Date(iso);
  }

  return isNaN(d) ? '' : `${d.getFullYear()}/${d.getMonth() + 1}/${d.getDate()}`;
}



function getScoreColor(score) {
  if (score === 'S') return 'green';
  if (score === 'A') return 'yellow';
  if (score === 'B') return 'red';
  return '';
}
function getSelectedYear() {
  const sel = document.getElementById('yearSelect').value;
  return sel === 'custom' ? document.getElementById('customYear').value.trim() : sel;
}
//document.getElementById('yearSelect').addEventListener('change', () => {
//  const customInput = document.getElementById('customYear');
//  customInput.style.display = getSelectedYear() === 'custom' ? 'inline' : 'none';
//  loadSheet();
//});
document.getElementById('customYear').addEventListener('input', loadSheet);

const headerRow = document.getElementById('headerRow');
const tableBody = document.getElementById('dataBody');
//headers.forEach(h => {
//  const th = document.createElement('th');
//  th.textContent = h;
//  th.classList.add('sticky');
//  if (h === 'æ™‚é–“æˆ³è¨˜') th.classList.add('tsCol');

//  if (hiddenCols.includes(h)) th.style.display = 'none'; // âœ… é è¨­éš±è—æ¨™é¡Œ
  
//  headerRow.appendChild(th);
//});

function buildResl(g) {
  let resl = '';
  const æ‹‰ç·šç¨®é¡ = g['æ‹‰ç·šç¨®é¡'] || '';
  const æ‹‰ç·šæ•¸é‡ = g['æ‹‰ç·šæ•¸é‡'] || '';
  const æ‹‰ç·šå‚™è¨» = g['2-1-1_æ‹‰ç·š_å‚™è¨»'] || '';
  const ä¿é¤Šé¸é … = g['4_ä¿é¤Šé¸é …'] || '';
  const é…ä»¶å‚™è¨»é¸æ“‡ = g['3-3.é…ä»¶_å‚™è¨»'] || '';
  const å…¶ä»–å‚™è¨» = g['4_å…¶ä»–_å‚™è¨»'] || '';
}

  
function loadSheet() {
  <!-- å…¬å‘Šå€  -->
  logDebug('ğŸ“¦ é–‹å§‹è¼‰å…¥è³‡æ–™...');
  logDebug('âœ… ç›®å‰ç‰ˆæœ¬ç‚º2025.4.9.v.A7');
  <!-- #END_å…¬å‘Šå€  -->
  
  const box = document.getElementById('loadingBox');
  if (box) box.style.display = 'block';

  Papa.parse(csvUrl, {
    download: true,
    header: true,
    skipEmptyLines: true,
    newline: "\n",  // âœ… æ­£ç¢ºè§£ææ¬„ä½ä¸­å¸¶æœ‰æ›è¡Œçš„å…§å®¹
    transform: function(value, column) {
      // âœ… å°‡æ¬„ä½å…§éƒ¨çš„æ›è¡Œç¬¦è™Ÿè™•ç†æ‰
      if (typeof value === 'string') {
          return value.replace(/\r?\n|\r/g, ', ');
        }
        return value;
    },
    complete: function(res) {
      logDebug(`âœ… æˆåŠŸè¼‰å…¥ ${res.data.length} ç­†è³‡æ–™`);
      if (box) box.style.display = 'none';

      // âœ… å„²å­˜æ‰€æœ‰è³‡æ–™
      allRows = res.data;

      // âœ…ğŸ‘‰ğŸ‘‰ğŸ‘‰ğŸ‘‰ğŸ‘‰ğŸ‘‰ğŸ‘‰ğŸ‘‰ğŸ‘‰ğŸ‘‰ğŸ‘‰ [é è¨­åªé¡¯ç¤ºå¹´åº¦è¨­å®šç‚º 114 çš„è³‡æ–™]
      // ğŸ‘‰ ğŸ‘‰ğŸ‘‰ğŸ‘‰ğŸ‘‰ğŸ‘‰ğŸ‘‰ğŸ‘‰ğŸ‘‰ğŸ‘‰ğŸ‘‰ğŸ‘‰ğŸ‘‰ğŸ‘‰ğŸ‘‰å¦‚è¦æ›´æ›é è¨­å¹´åº¦ï¼Œè«‹æ”¹é€™è£¡çš„å€¼
      const defaultYear = '114';
      filterByYear(defaultYear);
      
      //renderTable(allRows);
    }
  });
}
  
//--------
document.getElementById('yearSelect').addEventListener('change', () => {
  const sel = document.getElementById('yearSelect').value;
  const customInput = document.getElementById('customYear');
  const customBtn = document.getElementById('customYearBtn');

  if (sel === 'custom') {
    customInput.style.display = 'inline';
    customBtn.style.display = 'inline';
  } else {
    customInput.style.display = 'none';
    customBtn.style.display = 'none';
    filterByYear(sel); // âœ… é¸æ“‡å›ºå®šå¹´åº¦ï¼Œç«‹å³ç¯©é¸
  }
});

document.getElementById('customYearBtn').addEventListener('click', () => {
  const year = document.getElementById('customYear').value.trim();
  filterByYear(year);
});

//--------
  



function filterByYear(year) {
  const filtered = allRows.filter(g => (g['å¹´åº¦è¨­å®š'] || '').trim() === year);
  renderTable(filtered);
}

<!-- âœ… å…¨åŸŸè®Šæ•¸å­˜ gcu ä¸ŠæœŸç¶­è­·è³‡æ–™ -->
let gcuMap = new Map();
const gcuUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSGt73fpm3hhrIrsy3eCGRqYnZRoJN73NUaBaKRU6ILfAz9Tf20umubtZGuT0Q9bS8md_WkLVS4IFzv/pub?output=csv';

// è¼‰å…¥ GCU + å†è¼‰å…¥ä¸»è¡¨å–®è³‡æ–™
loadGCUandThenMainSheet();
  
function loadGCUandThenMainSheet() {
  Papa.parse(gcuUrl, {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: function(results) {
      const year_gcu = '114';
      const rows = results.data || [];

      gcuMap.clear();
      rows.forEach(row => {
        //æ¸¬è©¦
        const rawYear = row['å¹´åº¦è¨­å®š'];
        logDebug(`ğŸ§ª è®€åˆ°rawYearè¨­å®šï¼š${rawYear}`);
        
        if ((row['å¹´åº¦è¨­å®š'] || '').trim() === year_gcu) {
          const name = (row['åŸºåœ°å°åç¨±'] || '').trim();
          const prev = (row['ä¸ŠæœŸç¶­è­·'] || '').trim();
          gcuMap.set(name, prev);
          logDebug(`ğŸ“Œ ifå…§: GCU ç«™å°åç¨±ï¼š${name}`); //logdebug é¡¯ç¤ºè®€å–åˆ°çš„gcu.åŸºåœ°å°åç¨±
        }
      });

      logDebug(`âœ… GCU å·²å»ºç«‹æ¯”å° mapï¼Œå…± ${gcuMap.size} ç­†`);
      logDebug(`ğŸ“ å°‡ä½¿ç”¨å¹´åº¦ ${year_gcu} çš„ä¸ŠæœŸç¶­è­·è³‡æ–™é€²è¡Œæ¯”å°`);
      loadSheet(); // é€™æ™‚å†è¼‰å…¥ä¸»è¡¨å–®
    }
  });
}
<!-- #END_âœ… å…¨åŸŸè®Šæ•¸å­˜ gcu ä¸ŠæœŸç¶­è­·è³‡æ–™ -->
  
function renderTable(rows) {
  buildTableHeaders();         // âœ… é‡å»ºè¡¨æ ¼æ¨™é¡Œ
  tableBody.innerHTML = '';
  
  //headerRow.innerHTML = ''; // âœ… åŠ åœ¨é€™è£¡ï¼ˆæ¸…é™¤èˆŠæ¨™é¡Œï¼‰ æ¯æ¬¡åˆ‡æ›ç¯©é¸é‡æ–°éš±è—ä¸é¡¯ç¤ºçš„æ¨™é¡Œæ¬„ä½

  if (!rows.length) {
    const tr = document.createElement('tr');
    const td = document.createElement('td');
    td.colSpan = headers.length;
    td.textContent = 'ç„¡è³‡æ–™';
    td.style.textAlign = 'center';
    td.style.background = '#fff3cd';
    tr.appendChild(td);
    tableBody.appendChild(tr);
    return;
  }

  rows.forEach(g => {
    // âœ… è²¼ä¸Šä½  loadSheet() è£¡çš„ rows.forEach(g => { ... }) çš„åŸå§‹å…§å®¹
    let è¥¿å…ƒæª¢æŸ¥æ—¥æœŸä¾†æº = '';
        let è¥¿å…ƒæª¢æŸ¥æ—¥æœŸ = '';

        if ((g['å·¡æª¢æ—¥æœŸ'] || '').trim()) {
          è¥¿å…ƒæª¢æŸ¥æ—¥æœŸ = toDateOnly(g['å·¡æª¢æ—¥æœŸ']);
          è¥¿å…ƒæª¢æŸ¥æ—¥æœŸä¾†æº = 'å·¡æª¢æ—¥æœŸ';
        } else {
          è¥¿å…ƒæª¢æŸ¥æ—¥æœŸ = toDateOnly(g['æ™‚é–“æˆ³è¨˜']);
          è¥¿å…ƒæª¢æŸ¥æ—¥æœŸä¾†æº = 'æ™‚é–“æˆ³è¨˜';
        }

        console.log(`ğŸ“Œ ${g['ç«™å°åç¨±']} ä½¿ç”¨æ—¥æœŸä¾†æºï¼š${è¥¿å…ƒæª¢æŸ¥æ—¥æœŸä¾†æº} â†’ ${è¥¿å…ƒæª¢æŸ¥æ—¥æœŸ}ï¼ˆåŸå§‹æ™‚é–“æˆ³è¨˜ï¼š${g['æ™‚é–“æˆ³è¨˜']}ï¼‰`);

        const æœ¬æ¬¡æª¢æŸ¥ = toTWDate(è¥¿å…ƒæª¢æŸ¥æ—¥æœŸ);
        let å‹å¼ = `${g['éµå¡”ç¯€æ•¸']}ç¯€ (${g['éµå¡”å‹æ…‹']})`;
        let é«˜åº¦ = g['éµå¡”ç¯€æ•¸'] === '1.5' ? 8.7 : isNaN(g['éµå¡”ç¯€æ•¸']) ? '*' : (+g['éµå¡”ç¯€æ•¸'] * 5.5).toFixed(1);
       
        //âœ…3Gæ‹†å°ç´€éŒ„/æ–½å·¥äººå“¡
        let æ‹†å° = '';
        const æ‹†å°å…§å®¹ = g['8_3Gæ‹†å°'] || '';
        const æ‹†å°å‰å…©å­— = æ‹†å°å…§å®¹.substring(0, 2);
        const æ–½å·¥äººå“¡ = (g['8.2_3Gæ‹†å°_æ–½å·¥äººå“¡'] || '').replace(/\n/g, ', ');

        console.log('ğŸ§ª ç«™åï¼š', g['ç«™å°åç¨±'], 'ï½œæ‹†å°æ¬„ä½ï¼š', æ‹†å°å…§å®¹, 'ï½œæ–½å·¥äººå“¡åŸå§‹å€¼ï¼š', g['8.2_3Gæ‹†å°_æ–½å·¥äººå“¡']);

        if (æ‹†å°å‰å…©å­— === 'ç”±æ–½') {
          æ‹†å° = `${æ‹†å°å…§å®¹}ï¼Œæ–½å·¥äººå“¡ï¼š${æ–½å·¥äººå“¡}`;
        } else if (æ‹†å°å‰å…©å­— === 'åŸºç¶­') {
          æ‹†å° = æ‹†å°å…§å®¹;
        } else {
          æ‹†å° = ''; // å…¶ä»–ç‹€æ³ç•™ç©º
        }

    
        const ç§å¯†å‚™è¨» = g['ç§å¯†å‚™è¨»'] || g['ç§å¯†å‚™è¨» '] || '';
        let aa = 0, bb = 0;
        if (+g['8.1_3Gæ‹†å°_æ•¸é‡ [ä¸»é«”è¨­å‚™(ç³»çµ±/å°„é »/é›»åŠ›)]'] >= 1) aa = 500;
        bb += (+g['8.1_3Gæ‹†å°_æ•¸é‡ [Pipe(æ”¯)]'] || 0) * 150;
        bb += (+g['8.1_3Gæ‹†å°_æ•¸é‡ [å®¤å¤–å‹å¤©ç·š(æ”¯)]'] || 0) * 100;
        bb += (+g['8.1_3Gæ‹†å°_æ•¸é‡ [SMR(çµ„)]'] || 0) * 300;
        bb += (+g['8.1_3Gæ‹†å°_æ•¸é‡ [Mini shelter/å°å‹æ©Ÿæ«ƒ(åª)]'] || 0) * 250;
        bb += (+g['8.1_3Gæ‹†å°_æ•¸é‡ [é›»éŒ¶ç®±/é…é›»ç®±(åª)]'] || 0) * 200;
        if (bb > 1500) bb = 1500;
        const éŒ¢éŒ¢ = aa + bb;

        // âœ… åˆ¤æ–·ä¸€èˆ¬æˆ–ééµï¼Œç”¢å‡º resl
        let resl = '';
        const isééµ = (g['éµå¡”ç¯€æ•¸'] || '').substring(0, 4) === 'å…¶ä»–ééµ';
        
        if (isééµ) {
          å‹å¼ = g['NON-å‹å¼'] || '';
          é«˜åº¦ = g['NON-é«˜åº¦(ç±³)'] || '';
          
          const åŸå§‹æ”¹å–„ = (g['NON-æª¢æŸ¥èˆ‡æ”¹å–„'] || '').split(',').map(s => s.trim());
          let non_check = '';
          let otherItems = [];
          
          åŸå§‹æ”¹å–„.forEach(txt => {
            if (txt === 'æ‹‰ç·šXXæ¢XXçµç·šåˆæ ¼') {
              const qty = g['NON-æ‹‰ç·šæ•¸é‡'] || '';
              const type = g['NON-æ‹‰ç·šç¨®é¡'] || '';
              non_check += `æ‹‰ç·š(${qty}æ¢${type})æª¢æŸ¥åˆæ ¼ï¼Œ`;
            } else if (/XXæª¢æŸ¥åˆæ ¼/.test(txt)) {
              non_check += `${g['NON-å‹å¼'] || ''}æª¢æŸ¥åˆæ ¼ï¼Œ`;
            } else {
              otherItems.push(txt);
            }
          });
          
          non_check += otherItems.join('ï¼Œ') + 'ï¼Œ';
          resl = non_check;

        } else {
          // âœ… æ”¹å¯«ä¸€èˆ¬ resl çµ„åˆï¼ˆéµå¡”å‹æ…‹ï¼‰
          if (g['1-1_éµå¡”_è§’åº¦'] === 'åˆæ ¼') resl += 'éµå¡”è§’åº¦åˆæ ¼ï¼Œ';
          if (g['1-2_éµå¡”_é˜²å¢œå™¨'] === 'åˆæ ¼') resl += 'é˜²å¢œå™¨æª¢æŸ¥åˆæ ¼ï¼Œ';
          else if (g['1-2_éµå¡”_é˜²å¢œå™¨'] === 'èª¿æ•´') resl += 'é˜²å¢œå™¨é¬†å¼›èª¿æ•´ï¼Œ';
          else if (g['1-2_éµå¡”_é˜²å¢œå™¨'] === 'ç„¡é˜²å¢œå™¨') resl += 'ç„¡é˜²å¢œå™¨ï¼Œ';

          //æ‹‰ç·š
          const æ‹‰ç·šæ•¸é‡ = g['æ‹‰ç·šæ•¸é‡'] || '';
          const æ‹‰ç·šç¨®é¡ = g['æ‹‰ç·šç¨®é¡'] || '';
          
          if (æ‹‰ç·šæ•¸é‡ !== '0' && æ‹‰ç·šæ•¸é‡ !== 0 && æ‹‰ç·šæ•¸é‡ !== '') {
            if (g['2-1_æ‹‰ç·š'] === 'åˆæ ¼') {
              resl += `æ‹‰ç·š(${æ‹‰ç·šæ•¸é‡}æ¢${æ‹‰ç·šç¨®é¡})æª¢æŸ¥åˆæ ¼ï¼Œ`;
            } else if (g['2-1_æ‹‰ç·š'] === 'èª¿æ•´') {
              resl += `æ‹‰ç·š(${æ‹‰ç·šæ•¸é‡}æ¢${æ‹‰ç·šç¨®é¡})æª¢æŸ¥åˆæ ¼ï¼Œæ‹‰ç·šé¬†å¼›èª¿æ•´ï¼Œ`;
            } else {
              resl += `æ‹‰ç·š(${æ‹‰ç·šæ•¸é‡}æ¢${æ‹‰ç·šç¨®é¡})${g['2-1_æ‹‰ç·š'] || ''}ï¼Œ`;
            }
          }
        
          if (!((g['4_ä¿é¤Šé¸é …'] || '').includes('æœªå¡—æŸæ²¹æ¼†'))) {
            resl += 'é…ä»¶å¡—åˆ·æŸæ²¹æ¼†ä¿é¤Šï¼Œ';
          }
        }
        
        // âœ… å…±ç”¨å‚™è¨»å€ï¼ˆç„¡è«–ä¸€èˆ¬æˆ–ééµéƒ½è¦åŠ ï¼‰
        const å…±ç”¨å‚™è¨» = [
          g['3-3.é…ä»¶_å‚™è¨»'],
          g['3-3-1.é…ä»¶_å‚™è¨»_é¸æ“‡'],
          g['4_å…¶ä»–_å‚™è¨»'],
          g['6_å…¶ä»–äº‹é …']
        ].filter(Boolean).join('ï¼Œ');
        

        // âœ… åŠ å…¥å…±ç”¨å‚™è¨»èˆ‡é™¤è‰è³‡è¨Š
        
        const é™¤è‰åˆ¤æ–· = g['5_é™¤è‰'] === 'æ˜¯' ? 'ä»¥åŠé™¤è‰' : '';
        //  åŠ å…¥å…±ç”¨å‚™è¨»
        if (å…±ç”¨å‚™è¨») {
          resl += `ï¼Œ${å…±ç”¨å‚™è¨»}`;
        }
        
        //  åŠ å…¥é™¤è‰åˆ¤æ–·å‰ï¼Œè‹¥çµå°¾ç‚º"ï¼Œ"ï¼Œå…ˆç§»é™¤
        if (é™¤è‰åˆ¤æ–·) {
          // å¦‚æœå‰é¢å·²ç¶“æœ‰ã€Œï¼Œä»¥åŠã€æˆ–å·²ç¶“é€—è™Ÿçµå°¾ï¼Œå‰‡åˆªæ‰æœ«å°¾é€—è™Ÿå†åŠ é™¤è‰
          resl = resl.replace(/ï¼Œ+$/, ''); // ğŸ” ç§»é™¤æ‰€æœ‰é€£çºŒçš„çµå°¾é€—è™Ÿ
          resl += `ï¼Œ${é™¤è‰åˆ¤æ–·}`;
        }
        
        // âœ… æ¸…ç†é‡è¤‡æ¨™é»ã€è£œä¸Šå¥é» æ•´ç†æ¨™é»èˆ‡çµå°¾
        resl = resl.replace(/ï¼Œ{2,}/g, 'ï¼Œ'); // é¿å…é€£çºŒé€—è™Ÿ
        resl = resl.replace(/ï¼Œã€‚$/, 'ã€‚');   // è™•ç†éŒ¯èª¤çš„ã€Œï¼Œã€‚ã€çµå°¾
        resl = resl.replace(/ï¼Œ$/, 'ã€‚');   // è‹¥çµå°¾æ˜¯ã€Œï¼Œã€ï¼Œæ”¹ç‚ºã€Œã€‚ã€
        if (!resl.endsWith('ã€‚')) {
          resl += 'ã€‚'; // è‹¥æ²’æœ‰å¥é»ï¼Œå°±è£œä¸Š
        }

    
        const data = [
          g['æ™‚é–“æˆ³è¨˜'], g['ç«™å°åç¨±'], g['è½„å€(é«˜é›„ã€é³³å±±....)'], å‹å¼, é«˜åº¦, 
          gcuMap.get((g['ç«™å°åç¨±'] || '').trim()) || '',  // âœ… ä¸ŠæœŸç¶­è­·
          æœ¬æ¬¡æª¢æŸ¥, resl, '', '', è¥¿å…ƒæª¢æŸ¥æ—¥æœŸ, g['7_è©•åˆ†'], ç§å¯†å‚™è¨»,
          æ‹†å°, g['8.1_3Gæ‹†å°_æ•¸é‡ [ä¸»é«”è¨­å‚™(ç³»çµ±/å°„é »/é›»åŠ›)]'],
          g['8.1_3Gæ‹†å°_æ•¸é‡ [Pipe(æ”¯)]'], g['8.1_3Gæ‹†å°_æ•¸é‡ [å®¤å¤–å‹å¤©ç·š(æ”¯)]'],
          g['8.1_3Gæ‹†å°_æ•¸é‡ [SMR(çµ„)]'], g['8.1_3Gæ‹†å°_æ•¸é‡ [Mini shelter/å°å‹æ©Ÿæ«ƒ(åª)]'],
          g['8.1_3Gæ‹†å°_æ•¸é‡ [é›»éŒ¶ç®±/é…é›»ç®±(åª)]'], éŒ¢éŒ¢, g['å¹´åº¦è¨­å®š']
        ];

        const tr = document.createElement('tr');

        
               
        data.forEach((v, i) => {
          const td = document.createElement('td');
          td.textContent = v || '';
          if (i === 0) td.classList.add('tsCol');
          if (headers[i] === 'è©•åˆ†') {
            const cls = getScoreColor(v);
            if (cls) td.classList.add(cls); // é˜²æ­¢ç©ºå€¼
          }

          // éš±è—åŠŸèƒ½ 
          if (hiddenCols.includes(headers[i])) {
            td.style.display = 'none';
          }
          
          tr.appendChild(td);
        });
        tableBody.appendChild(tr);
  });
}

<!-- é¡¯ç¤ºéš±è—è¡¨æ ¼ -->
// æ ¹æ“šæ¬„ä½æ¨™é¡Œåç¨±é¡¯ç¤ºæ¬„ä½
// âœ… æ ¹æ“šæ¬„ä½æ¨™é¡Œé¡¯ç¤º/éš±è—æ¬„ä½ï¼ˆæ”¯æ´åˆ‡æ›ï¼‰
function toggleCols(colNames) {
  const headerCells = document.querySelectorAll('#headerRow th');
  const bodyRows = document.querySelectorAll('#dataBody tr');

  colNames.forEach(colName => {
    const idx = headers.indexOf(colName);
    if (idx === -1) return;

    // åˆ¤æ–·ç›®å‰æ˜¯å¦éš±è—
    const isHidden = headerCells[idx]?.style.display === 'none';

    // åˆ‡æ›é¡¯ç¤ºç‹€æ…‹ï¼šå¦‚æœæ˜¯éš±è—å°±é¡¯ç¤ºï¼Œå¦å‰‡å°±éš±è—
    const displayStyle = isHidden ? '' : 'none';

    // âœ… é¡¯ç¤ºæˆ–éš±è—æ¨™é¡Œåˆ— (th)
    if (headerCells[idx]) headerCells[idx].style.display = displayStyle;

    // âœ… é¡¯ç¤ºæˆ–éš±è—è³‡æ–™åˆ— (td)
    bodyRows.forEach(row => {
      const cell = row.children[idx];
      if (cell) cell.style.display = displayStyle;
    });
  });
}


// æª¢æŸ¥å¯†ç¢¼ä¸¦é¡¯ç¤ºç§å¯†æ¬„ä½
function checkPassword() {
  const val = document.getElementById('secretPwd').value;
  if (val === '5566') {
    toggleCols(['ç§å¯†å‚™è¨»']);
  } else {
    alert('å¯†ç¢¼éŒ¯èª¤');
  }
}
<!-- #END_é¡¯ç¤ºéš±è—è¡¨æ ¼ -->


// ğŸ”§ æŠ½æˆç¨ç«‹å‡½å¼ï¼šå»ºç«‹è¡¨é ­
function buildTableHeaders() {
  headerRow.innerHTML = ''; // âœ… æ¸…é™¤èˆŠæ¨™é¡Œå†é‡å»º

  headers.forEach(h => {
    const th = document.createElement('th');
    th.textContent = h;
    th.classList.add('sticky'); // è®“æ¨™é¡Œå›ºå®š
    if (hiddenCols.includes(h)) {
      th.style.display = 'none'; // âœ… è‹¥æ­¤æ¬„éœ€éš±è—ï¼Œéš±è— <th>
    }
    headerRow.appendChild(th);
  });
}

function logDebug(msg) {
  console.log('[debug]', msg);
  const debugDiv = document.getElementById('debug');
  if (!debugDiv) return;

  const successLoadRegex = /^âœ… æˆåŠŸè¼‰å…¥ \d+ ç­†è³‡æ–™$/;

    // ç‰¹åˆ¥è™•ç†â€œæˆåŠŸè¼‰å…¥â€è¨Šæ¯
    if (successLoadRegex.test(msg.trim())) {
      const tempDiv = document.createElement('div');
      tempDiv.textContent = msg;
      tempDiv.classList.add('fade-out');
      debugDiv.appendChild(tempDiv);

      setTimeout(() => {
        tempDiv.classList.add('hidden');
      }, 100); // è§¸ç™¼ transition

      setTimeout(() => {
        debugDiv.removeChild(tempDiv);
      }, 3000);
    } else {
      // å…¶ä»–è¨Šæ¯æ­£å¸¸é¡¯ç¤ºï¼ˆä¸æœƒè‡ªå‹•æ¶ˆå¤±ï¼‰
      const line = document.createElement('div');
      line.textContent = msg;
      debugDiv.appendChild(line);
    }

  
}
  
</script>
</body>
</html>
