<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>ç«™å°æª¢æŸ¥è¡¨ï¼ˆä¿®æ­£ç‰ˆï¼‰</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f9f9f9; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 4px; text-align: center; }
    th.sticky { position: sticky; top: 0; background: #eee; z-index: 2; }
    td.score-S { background: #d4edda; }
    td.score-A { background: #fff3cd; }
    td.score-B { background: #f8d7da; }
    td.tsCol { width: 1px !important; max-width: 1px !important; overflow: hidden; font-size: 0.5em; color: transparent; }
  </style>
</head>
<body>
<h2>ğŸ“‹ ç«™å°å¹´åº¦æª¢æŸ¥ç´€éŒ„</h2>
<table id="dataTable">
  <thead><tr id="headerRow"></tr></thead>
  <tbody id="tableBody"></tbody>
</table>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTnvECTbipdQIBkYB1-s4MgjWbTVQc5KkvoQuamlv8u7Q7rUCoV4TMpWfg4v2zowFRQNwhHWDnO9_n1/pub?output=csv';
const headers = [
  'æ™‚é–“æˆ³è¨˜','åŸºåœ°å°åç¨±','è½„å€','å‹å¼','é«˜åº¦(ç±³)','ä¸ŠæœŸç¶­è­·','æœ¬æ¬¡æª¢æŸ¥','æª¢æŸ¥èˆ‡æ”¹å–„',
  'å®Œæˆæ—¥æœŸ','å‚™   è¨»','è¥¿å…ƒæª¢æŸ¥æ—¥æœŸ','è©•åˆ†','ç§å¯†å‚™è¨»',
  '3Gæ‹†å°ç´€éŒ„/æ–½å·¥äººå“¡','ä¸»é«”è¨­å‚™(ç³»çµ±/å°„é »/é›»åŠ›)','Pipe(æ”¯)','å®¤å¤–å‹å¤©ç·š(æ”¯)',
  'SMR(çµ„)','Mini shelter/å°å‹æ©Ÿæ«ƒ(åª)','é›»éŒ¶ç®±/é…é›»ç®±(åª)','éŒ¢éŒ¢'
];

const headerRow = document.getElementById('headerRow');
const tableBody = document.getElementById('tableBody');
headers.forEach(h => {
  const th = document.createElement('th');
  th.textContent = h;
  th.classList.add("sticky");
  if (h === 'æ™‚é–“æˆ³è¨˜') th.classList.add("tsCol");
  headerRow.appendChild(th);
});

function toROC(isoStr) {
  const d = new Date(isoStr);
  if (isNaN(d)) return '';
  return `${d.getFullYear() - 1911}/${d.getMonth() + 1}/${d.getDate()}`;
}

function toDateOnly(isoStr) {
  const d = new Date(isoStr);
  if (isNaN(d)) return '';
  return `${d.getFullYear()}/${d.getMonth() + 1}/${d.getDate()}`;
}

function buildResl(g) {
  let resl = '';
  if (g['1-1_éµå¡”_è§’åº¦'] === 'åˆæ ¼') resl += 'éµå¡”è§’åº¦åˆæ ¼ï¼Œ';
  else resl += 'éµå¡”è§’åº¦èª¿æ•´*******ï¼Œ';
  if (g['1-2_éµå¡”_é˜²å¢œå™¨'] === 'åˆæ ¼') resl += 'é˜²å¢œå™¨æª¢æŸ¥åˆæ ¼ï¼Œ';
  else if (g['1-2_éµå¡”_é˜²å¢œå™¨'] === 'ç„¡é˜²å¢œå™¨') resl += 'ç„¡é˜²å¢œå™¨ï¼Œ';
  else if (g['1-2_éµå¡”_é˜²å¢œå™¨'] !== 'ä¸éœ€é˜²å¢œå™¨') resl += 'é˜²å¢œå™¨èª¿æ•´ï¼Œ';

  if (g['2-1_æ‹‰ç·š'] === 'åˆæ ¼') {
    if (g['æ‹‰ç·šç¨®é¡'] === 'SP') resl += `æ‹‰ç·š(${g['æ‹‰ç·šæ•¸é‡']})æª¢æŸ¥åˆæ ¼ï¼Œ`;
    else resl += `æ‹‰ç·š(${g['æ‹‰ç·šæ•¸é‡']}æ¢${g['æ‹‰ç·šç¨®é¡']})æª¢æŸ¥åˆæ ¼ï¼Œ`;
  } else {
    if (g['æ‹‰ç·šç¨®é¡'] === 'SP')
      resl += `æ‹‰ç·š(${g['æ‹‰ç·šæ•¸é‡']})${g['2-1_æ‹‰ç·š']}${g['2-1-1_æ‹‰ç·š_å‚™è¨»']}ï¼Œ`;
    else
      resl += `æ‹‰ç·š(${g['æ‹‰ç·šæ•¸é‡']}æ¢${g['æ‹‰ç·šç¨®é¡']})${g['2-1_æ‹‰ç·š']}${g['2-1-1_æ‹‰ç·š_å‚™è¨»']}ï¼Œ`;
  }

  const ä¿é¤Š = g['4_ä¿é¤Šé¸é …'] || '';
  const é…ä»¶è¨»è¨˜ = g['3-3.é…ä»¶_å‚™è¨»'] || '';
  const å…¶ä»–è¨»è¨˜ = g['4_å…¶ä»–_å‚™è¨»'] || '';
  if (!ä¿é¤Š.includes('æœªå¡—æŸæ²¹æ¼†')) resl += 'é…ä»¶å¡—åˆ·æŸæ²¹æ¼†ä¿é¤Šï¼Œ';
  resl += é…ä»¶è¨»è¨˜ + (å…¶ä»–è¨»è¨˜ ? 'ï¼Œ' + å…¶ä»–è¨»è¨˜ : '');
  if (g['5_é™¤è‰'] === 'æ˜¯') resl += 'ä»¥åŠé™¤è‰';
  return resl.replace(/ï¼Œ$/, 'ã€‚').replace(/ã€‚$/, 'ã€‚') + 'ã€‚';
}

function calcMoney(g) {
  let aa = 0, bb = 0;
  if (+g['8.1_3Gæ‹†å°_æ•¸é‡ [ä¸»é«”è¨­å‚™(ç³»çµ±/å°„é »/é›»åŠ›)]'] >= 1) aa = 500;
  bb += Math.min(150 * (+g['8.1_3Gæ‹†å°_æ•¸é‡ [Pipe(æ”¯)]'] || 0), 1500);
  bb += 100 * (+g['8.1_3Gæ‹†å°_æ•¸é‡ [å®¤å¤–å‹å¤©ç·š(æ”¯)]'] || 0);
  bb += 300 * (+g['8.1_3Gæ‹†å°_æ•¸é‡ [SMR(çµ„)]'] || 0);
  bb += 250 * (+g['8.1_3Gæ‹†å°_æ•¸é‡ [Mini shelter/å°å‹æ©Ÿæ«ƒ(åª)]'] || 0);
  bb += 200 * (+g['8.1_3Gæ‹†å°_æ•¸é‡ [é›»éŒ¶ç®±/é…é›»ç®±(åª)]'] || 0);
  bb = Math.min(bb, 1500);
  return aa + bb;
}

Papa.parse(csvUrl, {
  download: true,
  header: true,
  complete: function(result) {
    const rows = result.data;
    rows.forEach(g => {
      const row = document.createElement('tr');
      const æª¢æŸ¥æ—¥æœŸ = g['å·¡æª¢æ—¥æœŸ'] || g['æ™‚é–“æˆ³è¨˜'];
      const æœ¬æ¬¡æª¢æŸ¥ = æª¢æŸ¥æ—¥æœŸ ? toROC(æª¢æŸ¥æ—¥æœŸ) : '';
      const è¥¿å…ƒæ—¥æœŸ = æª¢æŸ¥æ—¥æœŸ ? toDateOnly(æª¢æŸ¥æ—¥æœŸ) : '';
      const å‹å¼ = `${g['éµå¡”ç¯€æ•¸']}ç¯€ (${g['éµå¡”å‹æ…‹']})`;
      const é«˜åº¦ = g['éµå¡”ç¯€æ•¸'] === '1.5' ? 8.7 : isNaN(g['éµå¡”ç¯€æ•¸']) ? '*' : (+g['éµå¡”ç¯€æ•¸'] * 5.5).toFixed(1);
      const éŒ¢éŒ¢ = calcMoney(g);
      const ä¸‰æ‹†äººå“¡ = g['8_3Gæ‹†å°'] === 'ç”±æ–½å·¥è‚¡å”åŠ©æ‹†é™¤' ? `${g['8_3Gæ‹†å°']} æ–½å·¥äººå“¡: ${g['8.2_3Gæ‹†å°_æ–½å·¥äººå“¡']}` : '';
      const resl = buildResl(g);

      const data = [
        g['æ™‚é–“æˆ³è¨˜'], g['ç«™å°åç¨±'], g['è½„å€(é«˜é›„ã€é³³å±±....)'], å‹å¼, é«˜åº¦, '',
        æœ¬æ¬¡æª¢æŸ¥, resl, '', '', è¥¿å…ƒæ—¥æœŸ, g['7_è©•åˆ†'], g['ç§å¯†å‚™è¨»'],
        ä¸‰æ‹†äººå“¡, g['8.1_3Gæ‹†å°_æ•¸é‡ [ä¸»é«”è¨­å‚™(ç³»çµ±/å°„é »/é›»åŠ›)]'], g['8.1_3Gæ‹†å°_æ•¸é‡ [Pipe(æ”¯)]'],
        g['8.1_3Gæ‹†å°_æ•¸é‡ [å®¤å¤–å‹å¤©ç·š(æ”¯)]'], g['8.1_3Gæ‹†å°_æ•¸é‡ [SMR(çµ„)]'],
        g['8.1_3Gæ‹†å°_æ•¸é‡ [Mini shelter/å°å‹æ©Ÿæ«ƒ(åª)]'], g['8.1_3Gæ‹†å°_æ•¸é‡ [é›»éŒ¶ç®±/é…é›»ç®±(åª)]'], éŒ¢éŒ¢
      ];

      data.forEach((text, i) => {
        const td = document.createElement('td');
        td.textContent = text || '';
        if (i === 0) td.classList.add('tsCol');
        if (headers[i] === 'è©•åˆ†') td.classList.add('score-' + text);
        row.appendChild(td);
      });

      tableBody.appendChild(row);
    });
  }
});
</script>
</body>
</html>
